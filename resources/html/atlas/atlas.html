<link rel="stylesheet" href="{{_res_path}}html/atlas/atlas.css">



    <div class="background" style="background: url({{illustration}}) no-repeat; background-size: cover;">
        <img src="{{illustration}}" alt="曲绘-模糊">
    </div>
    <div class="big-box">
        <div class="box">
            <div class="info-box">
                <div class="name-box">
                    <div class="song">
                        <p name="pvis">{{song}}</p>
                        <!-- <p style="font-size: 45px;">{{song}}</p> -->
                    </div>
                    <div class="composer">
                        <p name="pvis">{{composer}}</p>
                    </div>
                </div>
                <div class="charts-box">
                    <div class="length">
                        <p name="pvis">{{length}}</p>
                    </div>
                    <div class="txt">
                        <div class="sqrt">
                            <p>SONG'S_INFO</p>
                        </div>
                        <div class="line">
                            {{if spinfo}}
                            <p name="pvis">{{#spinfo.replace(/\n/g,'<br\>')}}</p>
                            {{/if}}
                        </div>
                    </div>
                    <div class="chart">
                        <div class="rankbkg">
                            <div class="sqr"></div>
                            {{each chart}}
                            <div class="sqr rank-{{ chart_item.difficulty }}" style="background-color: rgba({{ value.rgba }});"></div>
                            {{/each}}
                        </div>
                        <div class="rank">
                            <p>\</p>
                            {{each chart}}
                            <div class="pBox">
                                <p name="pvis">{{$chart_item.difficulty}}</p>
                            </div>
                            {{/each}}
                        </div>
                        <div class="note-box">
                            <p>Difficulty</p>
                            {{each chart}}
                            <p>{{$value.difficulty}}</p>
                            {{/each}}
                        </div>
                        <div class="rank-box">
                            <div class="charter">
                                <p>Charter</p>
                            </div>
                            <div class="chart-info"> 
                                <p>Tap</p>
                                <p>Drag</p>
                                <p>Hold</p>
                                <p>Flick</p>
                            </div>
                            {{each chart}}
                            <div class="charter">
                                <p name="pvis">{{$value.charter}}</p>
                            </div>
                            <div class="chart-info">
                                <p>{{$value.tap}}</p>
                                <p>{{$value.drag}}</p>
                                <p>{{$value.hold}}</p>
                                <p>{{$value.flick}}</p>
                            </div>
                            {{/each}}
                        </div>
                        <div class="note-box">
                            <p>Total</p>
                            {{each chart}}
                            <p>{{$value.combo}}</p>
                            {{/each}}
                        </div>
                    </div>
                </div>
            </div>
            <div class="ill-box">
                <img src="{{illustration}}" alt="曲绘">
            </div>
        </div>
        <div class="other-info">
        {{if bpm}}
            <div class="other-box">
                <div class="title">
                    <p>BPM</p>
                </div>
                <div class="dcr">
                    <p>{{bpm}}</p>
                </div>{% for chart_item in chart %}
        {%if illustrator%}
            <div class="other-box">
                <div class="title">
                    <p>Illustrator</p>
                </div>
                <div class="dcr">
                    <p>{{illustrator}}</p>
                </div>
            </div>
        {%endif%}
        {%if chapter%}
            <div class="other-box">
                <div class="title">
                    <p>Chapter</p>
                </div>
                <div class="dcr">
                    <p>{{chapter}}</p>
                </div>
            </div>
        {%endif%}
        </div>
        <div class="leave">
            <div class="leave-box">
                {% for chart_item in chart %}

                {%if chart_item.difficulty == 'EZ'%}
                <div class="leave-ez">
                {%elif chart_item.difficulty == 'HD'%}
                <div class="leave-hd">
                {%elif chart_item.difficulty == 'IN'%}
                <div class="leave-in">
                {%elif chart_item.difficulty == 'AT'%}
                <div class="leave-at">
                {%elif chart_item.difficulty == 'SP'%}
                <div class="leave-sp">
                {%else%}
                <div class="leave-sp" style="background-color: rgba({{chart_item.rgba}});">
                {%endif%}
                <div class="ldif">
                    <p name="pvis">{{chart_item.difficulty}}</p>
                </div>
                <div class="lrank">
                    <p name="pvis">{{chart_item}}</p> ##############
                </div>
                </div>

            {{/each}}
        </div>
    </div>
</div>
<div class="createdbox">
    <div class="phi-plugin">
        <p>{{_plugin}}</p>
    </div>
    <div class="ver">
        <p>{{Version.ver}}</p>
    </div>
</div>
<div class="snow-box"> </div>

<script>
    function adjustFontSize() {
        //获取p元素
        var a = document.getElementsByName('pvis')
        for (var i = 0; i < a.length; ++i) {

            const songName = a[i]

            if (!songName) continue


            /*调整曲目名称字体大小*/
            var parentElement = songName.parentElement

            // var maxFontSize = 100 //设置最大字体大小

            // //如果字体宽度小于父元素宽度，则增大字体大小
            // while (songName.scrollWidth < parentElement.offsetWidth && songName.scrollHeight < parentElement.offsetHeight) {
            //     var style = window.getComputedStyle(songName, null).getPropertyValue('font-size')
            //     var fontSize = parseFloat(style)

            //     //检查是否已经达到最大字体大小
            //     if (fontSize >= maxFontSize) {
            //         break
            //     }

            //     songName.style.fontSize = (fontSize + 1) + "px"
            // }

            // 如果字体宽度大于父元素宽度，则减小字体大小
            while (songName.scrollWidth > parentElement.offsetWidth || songName.scrollHeight > parentElement.offsetHeight) {
                var style = window.getComputedStyle(songName, null).getPropertyValue('font-size')
                var fontSize = parseFloat(style);
                songName.style.fontSize = (fontSize - 1) + "px";
            }
        }
    }
    window.onload = adjustFontSize
    window.onresize = adjustFontSize
</script>